<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emily01News</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1e1b4b, #6d28d9, #db2777);
      color: white;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: rgba(0,0,0,0.4);
    }
    header h1 {
      font-size: 18px;
    }
    .config-btn {
      cursor: pointer;
      font-size: 20px;
    }
    .hidden { display: none; }
    .post {
      background: rgba(255,255,255,0.1);
      margin: 15px;
      padding: 15px;
      border-radius: 12px;
    }
    .post h3 { margin-top: 0; }
    .btn {
      background: rgba(255,255,255,0.2);
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      margin-right: 5px;
    }
    .comments {
      margin-top: 10px;
      padding-left: 10px;
      border-left: 2px solid rgba(255,255,255,0.3);
    }
    .comment {
      margin-top: 5px;
      padding: 5px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    .dark {
      background: #0f0f0f;
      color: #f1f1f1;
    }
  </style>
</head>
<body>
  <header>
    <h1>Emily01News</h1>
    <div>
      <span id="darkToggle" class="btn">üåô</span>
      <span class="config-btn" id="configBtn">E</span>
    </div>
  </header>

  <!-- √Årea secreta de publicar -->
  <section id="publishSection" class="hidden" style="padding:15px;">
    <h3>Nova publica√ß√£o</h3>
    <textarea id="postContent" placeholder="Escreva algo..." style="width:100%;height:60px;"></textarea><br><br>
    <input type="file" id="mediaInput" accept="image/*,video/*"><br><br>
    <button class="btn" id="publishBtn">Publicar</button>
  </section>

  <!-- Publica√ß√µes -->
  <main id="feed">
    <div class="post" data-id="1">
      <h3>Emily01news</h3>
      <p></p>
      <div>
        <button class="btn likeBtn">‚ù§Ô∏è Curtir (<span class="likeCount">0</span>)</button>
        <button class="btn viewBtn"> Visualiza√ß√µes (<span class="viewCount">0</span>)</button>
        <button class="btn shareBtn">üì§ Compartilhar</button>
        <button class="btn commentToggle">üí¨ Coment√°rios</button>
      </div>
      <div class="comments hidden">
        <input type="text" class="commentInput" placeholder="Escreva um coment√°rio..."/>
        <button class="btn addComment">Comentar</button>
        <div class="commentList"></div>
      </div>
    </div>
  </main>

  <script>
    const PASSWORD = "1234";
    const configBtn = document.getElementById("configBtn");
    const publishSection = document.getElementById("publishSection");
    const publishBtn = document.getElementById("publishBtn");
    const feed = document.getElementById("feed");
    const darkToggle = document.getElementById("darkToggle");

    // Co(senha)
    configBtn.addEventListener("click", () => {
      const input = prompt("Digite a senha:");
      if(input === PASSWORD){
        publishSection.classList.remove("hidden");
        alert("√Årea de publica√ß√£o liberada ‚úÖ");
      } else {
        alert("Senha incorreta ‚ùå");
      }
    });

    // Publicar novo post
    publishBtn.addEventListener("click", () => {
      const content = document.getElementById("postContent").value;
      const mediaInput = document.getElementById("mediaInput");
      if(!content && !mediaInput.files.length) return;

      const postId = Date.now();
      const post = document.createElement("div");
      post.className = "post";
      post.dataset.id = postId;

      let mediaHTML = "";
      if(mediaInput.files.length){
        const file = mediaInput.files[0];
        if(file.type.startsWith("image")){
          mediaHTML = `<img src="${URL.createObjectURL(file)}" style="max-width:100%;border-radius:8px;margin-top:10px;">`;
        } else if(file.type.startsWith("video")){
          mediaHTML = `<video controls style="max-width:100%;border-radius:8px;margin-top:10px;"><source src="${URL.createObjectURL(file)}"></video>`;
        }
      }

      post.innerHTML = `
        <h3>Voc√™ publicou:</h3>
        <p>${content}</p>
        ${mediaHTML}
        <div>
          <button class="btn likeBtn">‚ù§Ô∏è Curtir (<span class="likeCount">0</span>)</button>
          <button class="btn viewBtn"> Visualiza√ß√µes (<span class="viewCount">0</span>)</button>
          <button class="btn shareBtn">üì§ Compartilhar</button>
          <button class="btn commentToggle">üí¨ Coment√°rios</button>
        </div>
        <div class="comments hidden">
          <input type="text" class="commentInput" placeholder="Escreva um coment√°rio..."/>
          <button class="btn addComment">Comentar</button>
          <div class="commentList"></div>
        </div>
      `;
      feed.prepend(post);
      attachPostEvents(post);
    });

    // Modo escuro
    darkToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
    });

    // Fun√ß√µes para interagir com posts
    function attachPostEvents(post){
      const likeBtn = post.querySelector(".likeBtn");
      const likeCount = post.querySelector(".likeCount");
      const viewBtn = post.querySelector(".viewBtn");
      const viewCount = post.querySelector(".viewCount");
      const shareBtn = post.querySelector(".shareBtn");
      const commentToggle = post.querySelector(".commentToggle");
      const commentsDiv = post.querySelector(".comments");
      const addCommentBtn = post.querySelector(".addComment");
      const commentInput = post.querySelector(".commentInput");
      const commentList = post.querySelector(".commentList");

      // Curtir
      let liked = false;
      likeBtn.addEventListener("click", () => {
        if(!liked){
          likeCount.textContent = parseInt(likeCount.textContent)+1;
          liked = true;
        } else {
          alert("Voc√™ j√° curtiu!");
        }
      });

      // Visualiza√ß√µes √∫nicas (simula√ß√£o)
      if(!localStorage.getItem("viewed_"+post.dataset.id)){
        viewCount.textContent = parseInt(viewCount.textContent)+1;
        localStorage.setItem("viewed_"+post.dataset.id,"true");
      }

      // Compartilhar
      shareBtn.addEventListener("click", () => {
        if(navigator.share){
          navigator.share({title:"Emily01News",text:"Veja esta publica√ß√£o!",url:window.location.href});
        } else {
          navigator.clipboard.writeText(window.location.href);
          alert("Link copiado!");
        }
      });

      // Mostrar/ocultar coment√°rios
      commentToggle.addEventListener("click", () => {
        commentsDiv.classList.toggle("hidden");
      });

      // Adicionar coment√°rio
      addCommentBtn.addEventListener("click", () => {
        const text = commentInput.value;
        if(!text) return;
        const c = document.createElement("div");
        c.className = "comment";
        c.innerHTML = `${text} <button class="btn small likeComment">üëç (<span>0</span>)</button>`;
        const likeCBtn = c.querySelector(".likeComment");
        const span = c.querySelector("span");
        let likedC = false;
        likeCBtn.addEventListener("click", () => {
          if(!likedC){
            span.textContent = parseInt(span.textContent)+1;
            likedC = true;
          } else {
            alert("Voc√™ j√° curtiu este coment√°rio!");
          }
        });
        commentList.appendChild(c);
        commentInput.value = "";
      });
    }

    // Ativar eventos para post inicial
    document.querySelectorAll(".post").forEach(p => attachPostEvents(p));

</script>


  <script type="module">
  // SDKs via CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, updateDoc,
    doc, increment, arrayUnion, serverTimestamp, query, orderBy
  } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";

  // --- CONFIG: mantenha suas chaves do Firebase (j√° configuradas no console) ---
  const firebaseConfig = {
    apiKey: "AIzaSyBjnSLKBdpz13_9jxlqwnQRNLXNtfPoq9o",
    authDomain: "emily01-ab49c.firebaseapp.com",
    projectId: "emily01-ab49c",
    storageBucket: "emily01-ab49c.appspot.com", // use .appspot.com
    messagingSenderId: "955907136214",
    appId: "1:955907136214:web:516ea542ebb20e70f18777"
  };

  // Inicializa
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Elementos da p√°gina (assumo que j√° existem no seu HTML)
  const publishBtn = document.getElementById("publishBtn");
  const postContent = document.getElementById("postContent");
  const mediaInput = document.getElementById("mediaInput");
  const feed = document.getElementById("feed");
  const darkToggle = document.getElementById("darkToggle");
  const configBtn = document.getElementById("configBtn");
  const publishSection = document.getElementById("publishSection");

  // Fun√ß√£o que cria o elemento visual do post e anexa handlers
  function createPostElement(id, data) {
    const post = document.createElement("div");
    post.className = "post";
    post.dataset.id = id;

    const mediaHTML = data.media
      ? (data.media.includes(".mp4") ? `<video controls style="max-width:100%"><source src="${data.media}"></video>` : `<img src="${data.media}" style="max-width:100%;border-radius:8px;">`)
      : "";

    post.innerHTML = `
      <h3>${data.title || "Emily01News News"}</h3>
      <p>${data.text || ""}</p>
      ${mediaHTML}
      <div style="margin-top:8px;">
        <button class="btn likeBtn">‚ù§Ô∏è (<span class="likeCount">${data.likes||0}</span>)</button>
        <span style="margin-left:8px">üëÅÔ∏è <span class="viewCount">${(data.views||0)}</span></span>
        <button class="btn commentToggle" style="margin-left:12px">üí¨ Coment√°rios</button>
      </div>
      <div class="comments hidden" style="margin-top:8px">
        <input type="text" class="commentInput" placeholder="Escreva um coment√°rio..." style="width:70%">
        <button class="btn addComment">Comentar</button>
        <div class="commentList" style="margin-top:8px">
          ${(data.comments||[]).map(c => `<div class="comment">${c}</div>`).join("")}
        </div>
      </div>
    `;

    // Like handler
    post.querySelector(".likeBtn").addEventListener("click", async () => {
      const likeSpan = post.querySelector(".likeCount");
      likeSpan.textContent = parseInt(likeSpan.textContent) + 1;
      await updateDoc(doc(db, "posts", id), { likes: increment(1) });
    });

    // View is already incremented on loadPosts (server-side increment), but update UI if needed

    // Toggle comments
    const commentsDiv = post.querySelector(".comments");
    post.querySelector(".commentToggle").addEventListener("click", () => {
      commentsDiv.classList.toggle("hidden");
    });

    // Add comment
    post.querySelector(".addComment").addEventListener("click", async () => {
      const input = post.querySelector(".commentInput");
      const text = input.value.trim();
      if (!text) return;
      // Append visually
      const list = post.querySelector(".commentList");
      const el = document.createElement("div");
      el.className = "comment";
      el.textContent = text;
      list.appendChild(el);
      input.value = "";
      // Save to Firestore
      await updateDoc(doc(db, "posts", id), { comments: arrayUnion(text) });
    });

    return post;
  }

  // Publicar (envia m√≠dia ao Storage se houver e salva post no Firestore)
  publishBtn.addEventListener("click", async () => {
    const text = (postContent?.value || "").trim();
    if (!text && !(mediaInput && mediaInput.files.length)) return alert("Escreva algo ou adicione m√≠dia");

    let mediaURL = "";
    if (mediaInput && mediaInput.files.length) {
      const file = mediaInput.files[0];
      const fileRef = ref(storage, "uploads/" + Date.now() + "_" + file.name);
      await uploadBytes(fileRef, file);
      mediaURL = await getDownloadURL(fileRef);
    }

    await addDoc(collection(db, "posts"), {
      title: "Emily01News News",
      text,
      media: mediaURL,
      createdAt: serverTimestamp(),
      likes: 0,
      views: 0,
      comments: []
    });

    // limpar e recarregar
    if (postContent) postContent.value = "";
    if (mediaInput) mediaInput.value = "";
    loadPosts();
  });

  // Carrega posts ordenados do mais novo para o mais antigo, incrementando views
  async function loadPosts() {
    feed.innerHTML = "";
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const snap = await getDocs(q);
    for (const docSnap of snap.docs) {
      const id = docSnap.id;
      const data = docSnap.data();

      // incrementa views (cada vez que a lista √© carregada)
      await updateDoc(doc(db, "posts", id), { views: increment(1) });

      // criar o elemento com dados atualizados (usamos data mas UI mostrar√° data.views + 1)
      const postEl = createPostElement(id, { ...data, views: (data.views||0) + 1 });
      feed.appendChild(postEl);
    }
  }

  // Dark mode (se j√° existe bot√£o)
  if (darkToggle) darkToggle.addEventListener("click", () => document.body.classList.toggle("dark"));

  // Inicial
  loadPosts();

  // Observa√ß√£o: se tiver outro script antigo que manipula publishBtn/feed, remova-o para n√£o duplicar eventos.
</script>

</body>
</html>
    
